private applyCourseSecurity = async (courseId: number) => {
  const sp = getSP(this.props.context);
  const web = sp.web;

  // Read Visibility & OwnerGroups (IDs)
  const c = await web.lists.getByTitle('Courses').items.getById(courseId)
    .select('Id','VisibilityChoice','OwnerGroups/Id','Author/Id')
    .expand('OwnerGroups','Author')();

  const visibility: 'MeOnly' | 'SelectGroups' = (c.VisibilityChoice || 'MeOnly');
  const ownerUserId: number = c.Author && c.Author.Id;
  const groupIds: number[] = (c.OwnerGroups || []).map((g:any)=>g.Id);

  // Decide principals:
  const principalIds: number[] = [];
  if (ownerUserId) principalIds.push(ownerUserId);
  if (visibility === 'SelectGroups' && groupIds.length) principalIds.push(...groupIds);

  // Role definition (Contribute)
  const contrib = await web.roleDefinitions.getByName('Contribute')();
  const contribId = contrib.Id;

  // Utility: set ACL for a single item
  const setItemAcl = async (listTitle: string, id: number) => {
    const item = web.lists.getByTitle(listTitle).items.getById(id);
    // Break inheritance (do not copy perms)
    await item.breakRoleInheritance(false, false);
    // Add principals
    for (const pid of principalIds) {
      await item.roleAssignments.add(pid, contribId);
    }
  };

  // 1) Course
  await setItemAcl('Courses', courseId);

  // 2) Modules in this course
  const modules = await web.lists.getByTitle('Modules')
    .items.select('Id','CourseId').filter(`CourseId eq ${courseId}`).top(5000)();
  for (const m of modules) await setItemAcl('Modules', m.Id);

  // 3) Lessons under those modules
  const modIds = modules.map((m:any)=>m.Id);
  if (modIds.length) {
    // Chunk if needed; simple filter shown here:
    const lessons = await web.lists.getByTitle('Lessons')
      .items.select('Id','ModuleId')
      .filter(`ModuleId in (${modIds.join(',')})`).top(5000)();
    for (const l of lessons) await setItemAcl('Lessons', l.Id);
  }
};