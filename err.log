public async addAttachment(itemId: number, file: File): Promise<void> {
  const url =
    `${this.siteUrl}/_api/web/lists/getbytitle('${encodeURIComponent(this.listTitle)}')/items(${itemId})/AttachmentFiles/add(FileName='${encodeURIComponent(file.name)}')`;

  const buffer: ArrayBuffer = await this.readFileAsArrayBuffer(file);

  const resp: SPHttpClientResponse = await this.spHttpClient.post(
    url,
    SPHttpClient.configurations.v1,
    {
      headers: {
        "Accept": "application/json;odata=verbose",
        "Content-Type": "application/octet-stream"
      },
      body: buffer as any
    }
  );

  if (!resp.ok) {
    const t = await resp.text();
    throw new Error("Attachment upload failed: " + t);
  }
}

private readFileAsArrayBuffer(file: File): Promise<ArrayBuffer> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    reader.onerror = () => reject(new Error("Failed to read file."));
    reader.onload = () => resolve(reader.result as ArrayBuffer);

    reader.readAsArrayBuffer(file);
  });
}
